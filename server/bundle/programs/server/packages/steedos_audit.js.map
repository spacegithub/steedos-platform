{"version":3,"sources":["meteor://💻app/packages/steedos_audit/lib/audit_records.coffee","meteor://💻app/lib/audit_records.coffee","meteor://💻app/packages/steedos_audit/models/audit_records.coffee","meteor://💻app/models/audit_records.coffee","meteor://💻app/packages/steedos_audit/models/audit_login.coffee"],"names":["clone","getLookupFieldModifier","getLookupFieldValue","insertRecord","transformFieldValue","updateRecord","require","Creator","AuditRecords","reference_to","value","space_id","name_field_key","obj","previous_ids","reference_to_object","values","_","isArray","isObject","o","ids","getObject","NAME_FIELD_KEY","getCollection","find","_id","$in","fields","fetch","getOrderlySetByIds","pluck","join","field","isFunction","optionsFunction","isString","options","selected_value","utcOffset","isNull","isUndefined","type","moment","utc","format","isBoolean","map","option","contains","label","compact","userId","object_name","new_doc","collection","doc","record_id","space","_makeNewID","field_name","related_to","insert","previous_doc","modifier","modifierSet","modifierUnset","ref","convertObject","$set","$unset","each","v","k","db_new_value","db_previous_value","new_value","previous_value","toString","JSON","stringify","name","add","action","Objects","audit_records","icon","index","object","enable_audit","push","filterable","is_name","created","required","is_wide","created_by","list_views","all","filter_scope","columns","filter_fields","recent","permission_set","user","allowCreate","allowDelete","allowEdit","allowRead","modifyAllRecords","viewAllRecords","admin","audit_login","username","login_time","source_ip","location","login_type","status","browser","platform","application","client_version","api_type","api_version","login_url"],"mappings":"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","file":"/packages/steedos_audit.js","sourcesContent":["clone = require(\"clone\");\nCreator.AuditRecords = {}\n\ngetLookupFieldValue = (reference_to, value, space_id)->\n\tif _.isArray(reference_to) && _.isObject(value)\n\t\treference_to = value.o\n\t\tprevious_ids = value.ids\n\tif !_.isArray(previous_ids)\n\t\tprevious_ids = if value then [value] else []\n\treference_to_object = Creator.getObject(reference_to, space_id)\n\tname_field_key = reference_to_object.NAME_FIELD_KEY\n\tvalues = Creator.getCollection(reference_to, space_id).find({_id: {$in: previous_ids}}, {fields: {_id:1, \"#{name_field_key}\": 1}}).fetch()\n\tvalues = Creator.getOrderlySetByIds(values, previous_ids)\n\treturn (_.pluck values, name_field_key).join(',')\n\ngetLookupFieldModifier = (field, value, space_id)->\n\treference_to = field.reference_to\n\tif _.isFunction(reference_to)\n\t\treference_to = reference_to()\n\tif _.isFunction(field.optionsFunction)\n\t\tif _.isString(reference_to)\n\t\t\tif value\n\t\t\t\treturn getLookupFieldValue(reference_to, value, space_id)\n\t\telse\n\t\t\treturn ''\n\telse\n\t\treturn getLookupFieldValue(reference_to, value, space_id)\n\n###\n字段值转换规则:\n1 日期 格式存储为 (String): 2018-01-02\n2 时间 格式存储为 (String): 2018-01-02 23:12\n2 lookup 和下拉框，都是对应的显示名称 (name | label)\n3 boolean 就存是/否\n4 多行文本\\grid\\lookup有optionsFunction并且没有reference_to时 不记录新旧值, 只记录修改时间, 修改人, 修改的字段显示名\n###\ntransformFieldValue = (field, value, options)->\n\n\tif _.isNull(value) || _.isUndefined(value)\n\t\treturn\n\n\tutcOffset = options.utcOffset\n\tspace_id = options.space_id\n\n\tswitch field.type\n\t\twhen 'date'\n\t\t\treturn moment.utc(value).format('YYYY-MM-DD')\n\t\twhen 'datetime'\n\t\t\treturn moment(value).utcOffset(utcOffset).format('YYYY-MM-DD HH:mm')\n\t\twhen 'boolean'\n\t\t\tif _.isBoolean(value)\n\t\t\t\tif value\n\t\t\t\t\treturn '是'\n\t\t\t\telse\n\t\t\t\t\treturn '否'\n\t\twhen 'select'\n\t\t\tif _.isString(value)\n\t\t\t\tvalue = [value]\n\t\t\tselected_value = _.map field.options, (option)->\n\t\t\t\tif _.contains(value, option.value)\n\t\t\t\t\treturn option.label\n\t\t\treturn _.compact(selected_value).join(',')\n\t\twhen 'checkbox'\n\t\t\tif _.isString(value)\n\t\t\t\tvalue = [value]\n\t\t\tselected_value = _.map field.options, (option)->\n\t\t\t\tif _.contains(value, option.value)\n\t\t\t\t\treturn option.label\n\t\t\treturn _.compact(selected_value).join(',')\n\t\twhen 'lookup'\n\t\t\treturn getLookupFieldModifier(field, value, space_id)\n\t\twhen 'master_detail'\n\t\t\treturn getLookupFieldModifier(field, value, space_id)\n\t\twhen 'textarea'\n\t\t\treturn ''\n\t\twhen 'code'\n\t\t\treturn ''\n\t\twhen 'html'\n\t\t\treturn ''\n\t\twhen 'markdown'\n\t\t\treturn ''\n\t\twhen 'grid'\n\t\t\treturn ''\n\t\telse\n\t\t\treturn value\n\n# 新建时, 不记录明细\ninsertRecord = (userId, object_name, new_doc)->\n#\tif !userId\n#\t\treturn\n\n\tcollection = Creator.getCollection(\"audit_records\")\n\tspace_id = new_doc.space\n\trecord_id = new_doc._id\n\tdoc = {\n\t\t_id: collection._makeNewID()\n\t\tspace: space_id\n\t\tfield_name: \"已创建。\"\n\t\trelated_to: {\n\t\t\to: object_name\n\t\t\tids: [record_id]\n\t\t}\n\t}\n\tcollection.insert doc\n\n# 修改时, 记录字段变更明细\nupdateRecord = (userId, object_name, new_doc, previous_doc, modifier)->\n#\tif !userId\n#\t\treturn\n\tspace_id = new_doc.space\n\trecord_id = new_doc._id\n\n\tfields = Creator.convertObject(clone(Creator.getObject(object_name, space_id)), space_id)?.fields\n\n\tmodifierSet = modifier.$set\n\n\tmodifierUnset = modifier.$unset\n\n\t### TODO utcOffset 应该来自数据库,待 #984 处理后 调整\n\n    utcOffset = Creator.getCollection(\"users\").findOne({_id: userId})?.utcOffset\n\n\tif !_.isNumber(utcOffset)\n\t\tutcOffset = 8\n\t###\n\n\tutcOffset = 8\n\n\toptions = {utcOffset: utcOffset, space_id: space_id}\n\n\t_.each modifierSet, (v, k)->\n\t\tfield = fields?[k]\n\t\tprevious_value = previous_doc[k]\n\t\tnew_value = v\n\n\t\tdb_previous_value = null\n\t\tdb_new_value = null\n\n\t\tswitch field.type\n\t\t\twhen 'date'\n\t\t\t\tif new_value?.toString() != previous_value?.toString()\n\t\t\t\t\tif new_value\n\t\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\n\t\t\t\t\tif previous_value\n\t\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\n\t\t\twhen 'datetime'\n\t\t\t\tif new_value?.toString() != previous_value?.toString()\n\t\t\t\t\tif new_value\n\t\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\n\t\t\t\t\tif previous_value\n\t\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\n\t\t\twhen 'textarea'\n\t\t\t\tif previous_value != new_value\n\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\n\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\n\t\t\twhen 'code'\n\t\t\t\tif previous_value != new_value\n\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\n\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\n\t\t\twhen 'html'\n\t\t\t\tif previous_value != new_value\n\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\n\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\n\t\t\twhen 'markdown'\n\t\t\t\tif previous_value != new_value\n\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\n\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\n\t\t\twhen 'grid'\n\t\t\t\tif JSON.stringify(previous_value) != JSON.stringify(new_value)\n\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\n\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\n\t\t\twhen 'boolean'\n\t\t\t\tif previous_value != new_value\n\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\n\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\n\t\t\twhen 'select'\n\t\t\t\tif previous_value?.toString() != new_value?.toString()\n\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\n\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\n\t\t\twhen 'checkbox'\n\t\t\t\tif previous_value?.toString() != new_value?.toString()\n\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\n\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\n\t\t\twhen 'lookup'\n\t\t\t\tif JSON.stringify(previous_value) != JSON.stringify(new_value)\n\t\t\t\t\tif previous_value\n\t\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\n\t\t\t\t\tif new_value\n\t\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\n\t\t\twhen 'master_detail'\n\t\t\t\tif JSON.stringify(previous_value) != JSON.stringify(new_value)\n\t\t\t\t\tif previous_value\n\t\t\t\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\n\t\t\t\t\tif new_value\n\t\t\t\t\t\tdb_new_value = transformFieldValue(field, new_value, options)\n\t\t\telse\n\t\t\t\tif new_value != previous_value\n\t\t\t\t\tdb_previous_value = previous_value\n\t\t\t\t\tdb_new_value = new_value\n\n\t\tif (db_new_value != null && db_new_value != undefined) || (db_previous_value != null && db_previous_value != undefined)\n\t\t\tcollection = Creator.getCollection(\"audit_records\")\n\t\t\tdoc = {\n\t\t\t\t_id: collection._makeNewID()\n\t\t\t\tspace: space_id\n\t\t\t\tfield_name: field.label || field.name\n\t\t\t\tprevious_value: db_previous_value\n\t\t\t\tnew_value: db_new_value\n\t\t\t\trelated_to: {\n\t\t\t\t\to: object_name\n\t\t\t\t\tids: [record_id]\n\t\t\t\t}\n\t\t\t}\n\t\t\tcollection.insert doc\n\n\t_.each modifierUnset, (v, k)->\n\t\tfield = fields?[k]\n\t\tprevious_value = previous_doc[k]\n\t\tif previous_value || _.isBoolean(previous_value)\n\t\t\tcollection = Creator.getCollection(\"audit_records\")\n\t\t\tdb_previous_value = transformFieldValue(field, previous_value, options)\n\t\t\tdoc = {\n\t\t\t\t_id: collection._makeNewID()\n\t\t\t\tspace: space_id\n\t\t\t\tfield_name: field.label || field.name\n\t\t\t\tprevious_value: db_previous_value\n\t\t\t\trelated_to: {\n\t\t\t\t\to: object_name\n\t\t\t\t\tids: [record_id]\n\t\t\t\t}\n\t\t\t}\n\t\t\tcollection.insert doc\n\nCreator.AuditRecords.add = (action, userId, object_name, new_doc, previous_doc, modifier)->\n\tif action == 'update'\n\t\tupdateRecord(userId, object_name, new_doc, previous_doc, modifier)\n\telse if action == 'insert'\n\t\tinsertRecord(userId, object_name, new_doc)\n","var clone, getLookupFieldModifier, getLookupFieldValue, insertRecord, transformFieldValue, updateRecord;\n\nclone = require(\"clone\");\n\nCreator.AuditRecords = {};\n\ngetLookupFieldValue = function(reference_to, value, space_id) {\n  var name_field_key, obj, previous_ids, reference_to_object, values;\n  if (_.isArray(reference_to) && _.isObject(value)) {\n    reference_to = value.o;\n    previous_ids = value.ids;\n  }\n  if (!_.isArray(previous_ids)) {\n    previous_ids = value ? [value] : [];\n  }\n  reference_to_object = Creator.getObject(reference_to, space_id);\n  name_field_key = reference_to_object.NAME_FIELD_KEY;\n  values = Creator.getCollection(reference_to, space_id).find({\n    _id: {\n      $in: previous_ids\n    }\n  }, {\n    fields: (\n      obj = {\n        _id: 1\n      },\n      obj[\"\" + name_field_key] = 1,\n      obj\n    )\n  }).fetch();\n  values = Creator.getOrderlySetByIds(values, previous_ids);\n  return (_.pluck(values, name_field_key)).join(',');\n};\n\ngetLookupFieldModifier = function(field, value, space_id) {\n  var reference_to;\n  reference_to = field.reference_to;\n  if (_.isFunction(reference_to)) {\n    reference_to = reference_to();\n  }\n  if (_.isFunction(field.optionsFunction)) {\n    if (_.isString(reference_to)) {\n      if (value) {\n        return getLookupFieldValue(reference_to, value, space_id);\n      }\n    } else {\n      return '';\n    }\n  } else {\n    return getLookupFieldValue(reference_to, value, space_id);\n  }\n};\n\n\n/*\n字段值转换规则:\n1 日期 格式存储为 (String): 2018-01-02\n2 时间 格式存储为 (String): 2018-01-02 23:12\n2 lookup 和下拉框，都是对应的显示名称 (name | label)\n3 boolean 就存是/否\n4 多行文本\\grid\\lookup有optionsFunction并且没有reference_to时 不记录新旧值, 只记录修改时间, 修改人, 修改的字段显示名\n */\n\ntransformFieldValue = function(field, value, options) {\n  var selected_value, space_id, utcOffset;\n  if (_.isNull(value) || _.isUndefined(value)) {\n    return;\n  }\n  utcOffset = options.utcOffset;\n  space_id = options.space_id;\n  switch (field.type) {\n    case 'date':\n      return moment.utc(value).format('YYYY-MM-DD');\n    case 'datetime':\n      return moment(value).utcOffset(utcOffset).format('YYYY-MM-DD HH:mm');\n    case 'boolean':\n      if (_.isBoolean(value)) {\n        if (value) {\n          return '是';\n        } else {\n          return '否';\n        }\n      }\n      break;\n    case 'select':\n      if (_.isString(value)) {\n        value = [value];\n      }\n      selected_value = _.map(field.options, function(option) {\n        if (_.contains(value, option.value)) {\n          return option.label;\n        }\n      });\n      return _.compact(selected_value).join(',');\n    case 'checkbox':\n      if (_.isString(value)) {\n        value = [value];\n      }\n      selected_value = _.map(field.options, function(option) {\n        if (_.contains(value, option.value)) {\n          return option.label;\n        }\n      });\n      return _.compact(selected_value).join(',');\n    case 'lookup':\n      return getLookupFieldModifier(field, value, space_id);\n    case 'master_detail':\n      return getLookupFieldModifier(field, value, space_id);\n    case 'textarea':\n      return '';\n    case 'code':\n      return '';\n    case 'html':\n      return '';\n    case 'markdown':\n      return '';\n    case 'grid':\n      return '';\n    default:\n      return value;\n  }\n};\n\ninsertRecord = function(userId, object_name, new_doc) {\n  var collection, doc, record_id, space_id;\n  collection = Creator.getCollection(\"audit_records\");\n  space_id = new_doc.space;\n  record_id = new_doc._id;\n  doc = {\n    _id: collection._makeNewID(),\n    space: space_id,\n    field_name: \"已创建。\",\n    related_to: {\n      o: object_name,\n      ids: [record_id]\n    }\n  };\n  return collection.insert(doc);\n};\n\nupdateRecord = function(userId, object_name, new_doc, previous_doc, modifier) {\n  var fields, modifierSet, modifierUnset, options, record_id, ref, space_id, utcOffset;\n  space_id = new_doc.space;\n  record_id = new_doc._id;\n  fields = (ref = Creator.convertObject(clone(Creator.getObject(object_name, space_id)), space_id)) != null ? ref.fields : void 0;\n  modifierSet = modifier.$set;\n  modifierUnset = modifier.$unset;\n\n  /* TODO utcOffset 应该来自数据库,待 #984 处理后 调整\n  \n     utcOffset = Creator.getCollection(\"users\").findOne({_id: userId})?.utcOffset\n  \n  \tif !_.isNumber(utcOffset)\n  \t\tutcOffset = 8\n   */\n  utcOffset = 8;\n  options = {\n    utcOffset: utcOffset,\n    space_id: space_id\n  };\n  _.each(modifierSet, function(v, k) {\n    var collection, db_new_value, db_previous_value, doc, field, new_value, previous_value;\n    field = fields != null ? fields[k] : void 0;\n    previous_value = previous_doc[k];\n    new_value = v;\n    db_previous_value = null;\n    db_new_value = null;\n    switch (field.type) {\n      case 'date':\n        if ((new_value != null ? new_value.toString() : void 0) !== (previous_value != null ? previous_value.toString() : void 0)) {\n          if (new_value) {\n            db_new_value = transformFieldValue(field, new_value, options);\n          }\n          if (previous_value) {\n            db_previous_value = transformFieldValue(field, previous_value, options);\n          }\n        }\n        break;\n      case 'datetime':\n        if ((new_value != null ? new_value.toString() : void 0) !== (previous_value != null ? previous_value.toString() : void 0)) {\n          if (new_value) {\n            db_new_value = transformFieldValue(field, new_value, options);\n          }\n          if (previous_value) {\n            db_previous_value = transformFieldValue(field, previous_value, options);\n          }\n        }\n        break;\n      case 'textarea':\n        if (previous_value !== new_value) {\n          db_previous_value = transformFieldValue(field, previous_value, options);\n          db_new_value = transformFieldValue(field, new_value, options);\n        }\n        break;\n      case 'code':\n        if (previous_value !== new_value) {\n          db_previous_value = transformFieldValue(field, previous_value, options);\n          db_new_value = transformFieldValue(field, new_value, options);\n        }\n        break;\n      case 'html':\n        if (previous_value !== new_value) {\n          db_previous_value = transformFieldValue(field, previous_value, options);\n          db_new_value = transformFieldValue(field, new_value, options);\n        }\n        break;\n      case 'markdown':\n        if (previous_value !== new_value) {\n          db_previous_value = transformFieldValue(field, previous_value, options);\n          db_new_value = transformFieldValue(field, new_value, options);\n        }\n        break;\n      case 'grid':\n        if (JSON.stringify(previous_value) !== JSON.stringify(new_value)) {\n          db_previous_value = transformFieldValue(field, previous_value, options);\n          db_new_value = transformFieldValue(field, new_value, options);\n        }\n        break;\n      case 'boolean':\n        if (previous_value !== new_value) {\n          db_previous_value = transformFieldValue(field, previous_value, options);\n          db_new_value = transformFieldValue(field, new_value, options);\n        }\n        break;\n      case 'select':\n        if ((previous_value != null ? previous_value.toString() : void 0) !== (new_value != null ? new_value.toString() : void 0)) {\n          db_previous_value = transformFieldValue(field, previous_value, options);\n          db_new_value = transformFieldValue(field, new_value, options);\n        }\n        break;\n      case 'checkbox':\n        if ((previous_value != null ? previous_value.toString() : void 0) !== (new_value != null ? new_value.toString() : void 0)) {\n          db_previous_value = transformFieldValue(field, previous_value, options);\n          db_new_value = transformFieldValue(field, new_value, options);\n        }\n        break;\n      case 'lookup':\n        if (JSON.stringify(previous_value) !== JSON.stringify(new_value)) {\n          if (previous_value) {\n            db_previous_value = transformFieldValue(field, previous_value, options);\n          }\n          if (new_value) {\n            db_new_value = transformFieldValue(field, new_value, options);\n          }\n        }\n        break;\n      case 'master_detail':\n        if (JSON.stringify(previous_value) !== JSON.stringify(new_value)) {\n          if (previous_value) {\n            db_previous_value = transformFieldValue(field, previous_value, options);\n          }\n          if (new_value) {\n            db_new_value = transformFieldValue(field, new_value, options);\n          }\n        }\n        break;\n      default:\n        if (new_value !== previous_value) {\n          db_previous_value = previous_value;\n          db_new_value = new_value;\n        }\n    }\n    if ((db_new_value !== null && db_new_value !== void 0) || (db_previous_value !== null && db_previous_value !== void 0)) {\n      collection = Creator.getCollection(\"audit_records\");\n      doc = {\n        _id: collection._makeNewID(),\n        space: space_id,\n        field_name: field.label || field.name,\n        previous_value: db_previous_value,\n        new_value: db_new_value,\n        related_to: {\n          o: object_name,\n          ids: [record_id]\n        }\n      };\n      return collection.insert(doc);\n    }\n  });\n  return _.each(modifierUnset, function(v, k) {\n    var collection, db_previous_value, doc, field, previous_value;\n    field = fields != null ? fields[k] : void 0;\n    previous_value = previous_doc[k];\n    if (previous_value || _.isBoolean(previous_value)) {\n      collection = Creator.getCollection(\"audit_records\");\n      db_previous_value = transformFieldValue(field, previous_value, options);\n      doc = {\n        _id: collection._makeNewID(),\n        space: space_id,\n        field_name: field.label || field.name,\n        previous_value: db_previous_value,\n        related_to: {\n          o: object_name,\n          ids: [record_id]\n        }\n      };\n      return collection.insert(doc);\n    }\n  });\n};\n\nCreator.AuditRecords.add = function(action, userId, object_name, new_doc, previous_doc, modifier) {\n  if (action === 'update') {\n    return updateRecord(userId, object_name, new_doc, previous_doc, modifier);\n  } else if (action === 'insert') {\n    return insertRecord(userId, object_name, new_doc);\n  }\n};\n","Creator.Objects.audit_records =\n\tname: \"audit_records\"\n\tlabel: \"字段历史\"\n\ticon: \"record\"\n\tfields:\n\t\trelated_to:\n\t\t\tlabel: \"相关项\"\n\t\t\ttype: \"lookup\"\n\t\t\tindex: true\n\t\t\treference_to: ()->\n\t\t\t\to = []\n\t\t\t\t_.each Creator.Objects, (object, object_name)->\n\t\t\t\t\tif object.enable_audit\n\t\t\t\t\t\to.push object.name\n\t\t\t\treturn o\n\t\t\tfilterable:true\n\t\t\tis_name: true\n\t\tcreated:\n\t\t\tlabel:\"时间\"\n\t\t\tfilterable:true\n\t\tfield_name:\n\t\t\tlabel: \"字段\"\n\t\t\ttype: \"text\"\n\t\t\trequired: true\n\t\t\tis_wide: true\n\t\tcreated_by:\n\t\t\tlabel:\"用户\"\n\t\tprevious_value:\n\t\t\tlabel: \"原始值\"\n\t\t\ttype: \"text\"\n\t\tnew_value:\n\t\t\tlabel: \"新值\"\n\t\t\ttype: \"text\"\n\n\n\tlist_views:\n\t\tall:\n\t\t\tlabel: \"全部\"\n\t\t\tfilter_scope: \"space\"\n\t\t\tcolumns: [\"related_to\", \"created\", \"field_name\", \"created_by\", \"previous_value\", \"new_value\"]\n\t\t\tfilter_fields: [\"related_to\"]\n\t\trecent:\n\t\t\tlabel: \"最近查看\"\n\t\t\tfilter_scope: \"space\"\n\n\tpermission_set:\n\t\tuser:\n\t\t\tallowCreate: false\n\t\t\tallowDelete: false\n\t\t\tallowEdit: false\n\t\t\tallowRead: true\n\t\t\tmodifyAllRecords: false\n\t\t\tviewAllRecords: false\n\t\tadmin:\n\t\t\tallowCreate: false\n\t\t\tallowDelete: false\n\t\t\tallowEdit: false\n\t\t\tallowRead: true\n\t\t\tmodifyAllRecords: false\n\t\t\tviewAllRecords: true","Creator.Objects.audit_records = {\n  name: \"audit_records\",\n  label: \"字段历史\",\n  icon: \"record\",\n  fields: {\n    related_to: {\n      label: \"相关项\",\n      type: \"lookup\",\n      index: true,\n      reference_to: function() {\n        var o;\n        o = [];\n        _.each(Creator.Objects, function(object, object_name) {\n          if (object.enable_audit) {\n            return o.push(object.name);\n          }\n        });\n        return o;\n      },\n      filterable: true,\n      is_name: true\n    },\n    created: {\n      label: \"时间\",\n      filterable: true\n    },\n    field_name: {\n      label: \"字段\",\n      type: \"text\",\n      required: true,\n      is_wide: true\n    },\n    created_by: {\n      label: \"用户\"\n    },\n    previous_value: {\n      label: \"原始值\",\n      type: \"text\"\n    },\n    new_value: {\n      label: \"新值\",\n      type: \"text\"\n    }\n  },\n  list_views: {\n    all: {\n      label: \"全部\",\n      filter_scope: \"space\",\n      columns: [\"related_to\", \"created\", \"field_name\", \"created_by\", \"previous_value\", \"new_value\"],\n      filter_fields: [\"related_to\"]\n    },\n    recent: {\n      label: \"最近查看\",\n      filter_scope: \"space\"\n    }\n  },\n  permission_set: {\n    user: {\n      allowCreate: false,\n      allowDelete: false,\n      allowEdit: false,\n      allowRead: true,\n      modifyAllRecords: false,\n      viewAllRecords: false\n    },\n    admin: {\n      allowCreate: false,\n      allowDelete: false,\n      allowEdit: false,\n      allowRead: true,\n      modifyAllRecords: false,\n      viewAllRecords: true\n    }\n  }\n};\n","Creator.Objects.audit_login =\n\tname: \"audit_login\"\n\tlabel: \"登录日志\"\n\ticon: \"record\"\n\tfields:\n\t\tusername:\n\t\t\tlabel: \"用户名\"\n\t\t\ttype: \"text\"\n\t\t\tis_name: true\n\n\t\tlogin_time:\n\t\t\tlabel:\"登录时间\"\n\t\t\ttype: \"datetime\"\n\n\t\tsource_ip:\n\t\t\tlabel: \"IP地址\"\n\t\t\ttype: \"text\"\n\n\t\tlocation:\n\t\t\tlabel:\"位置\"\n\t\t\ttype: \"text\"\n\n\t\tlogin_type:\n\t\t\tlabel: \"登录方式\"\n\t\t\ttype: \"text\"\n\n\t\tstatus:\n\t\t\tlabel: \"状态\"\n\t\t\ttype: \"text\"\n\n\t\tbrowser:\n\t\t\tlabel: \"浏览器\"\n\t\t\ttype: \"text\"\n\n\t\tplatform:\n\t\t\tlabel: \"系统\"\n\t\t\ttype: \"text\"\n\n\t\tapplication:\n\t\t\tlabel: \"应用\"\n\t\t\ttype: \"text\"\n\n\t\tclient_version:\n\t\t\tlabel: \"客户端版本\"\n\t\t\ttype: \"text\"\n\n\t\tapi_type:\n\t\t\tlabel: \"api类型\"\n\t\t\ttype: \"text\"\n\n\t\tapi_version:\n\t\t\tlabel: \"api版本\"\n\t\t\ttype: \"text\"\n\n\t\tlogin_url:\n\t\t\tlabel: \"登录URL\"\n\t\t\ttype: \"text\"\n\n\tlist_views:\n\t\tall:\n\t\t\tlabel: \"全部\"\n\t\t\tfilter_scope: \"space\"\n\t\t\tcolumns: [\"username\", \"login_time\", \"source_ip\", \"location\", \"login_type\", \"status\", \"browser\", \"platform\", \"application\", \"client_version\", \"api_type\", \"api_version\", \"login_url\"]\n\t\trecent:\n\t\t\tlabel: \"最近查看\"\n\t\t\tfilter_scope: \"space\"\n\n\tpermission_set:\n\t\tuser:\n\t\t\tallowCreate: false\n\t\t\tallowDelete: false\n\t\t\tallowEdit: false\n\t\t\tallowRead: true\n\t\t\tmodifyAllRecords: false\n\t\t\tviewAllRecords: false\n\t\tadmin:\n\t\t\tallowCreate: false\n\t\t\tallowDelete: false\n\t\t\tallowEdit: false\n\t\t\tallowRead: true\n\t\t\tmodifyAllRecords: false\n\t\t\tviewAllRecords: true"]}