{"version":3,"sources":["meteor://ðŸ’»app/packages/steedos:cfs-data-man/checkNpm.js","meteor://ðŸ’»app/packages/steedos:cfs-data-man/server/data-man-api.js","meteor://ðŸ’»app/packages/steedos:cfs-data-man/server/data-man-buffer.js","meteor://ðŸ’»app/packages/steedos:cfs-data-man/server/data-man-datauri.js","meteor://ðŸ’»app/packages/steedos:cfs-data-man/server/data-man-filepath.js","meteor://ðŸ’»app/packages/steedos:cfs-data-man/server/data-man-url.js","meteor://ðŸ’»app/packages/steedos:cfs-data-man/server/data-man-readstream.js"],"names":["checkNpmVersions","module","link","v","require","mime","request","temp","fs","Readable","DataMan","data","type","options","self","buffer","Error","Buffer","source","ArrayBuffer","Uint8Array","EJSON","isBinary","ReadStream","slice","DataURI","URL","FilePath","prototype","getBuffer","dataManGetBuffer","callback","Meteor","wrapAsync","bind","_saveToFile","readStream","filePath","writeStream","createWriteStream","on","bindEnvironment","error","pipe","saveToFile","dataManSaveToFile","createReadStream","getDataUri","dataManGetDataUri","dataManCreateReadStream","size","dataManSize","dataManType","Array","nativeBind","Function","ctor","isFunction","obj","Object","toString","call","func","context","args","bound","apply","arguments","TypeError","concat","result","bufferStreamReader","DataManBuffer","_type","dataManBufferGetBuffer","dataManBufferGetDataUri","dataUri","dataManBufferCreateReadStream","dataManBufferSize","_size","length","dataManBufferType","DataManDataURI","pieces","match","DataManFilePath","filepath","lookup","dataManFilePathGetBuffer","readFile","err","dataManFilePathGetDataUri","dataManFilePathCreateReadStream","dataManFilePathSize","stat","stats","dataManFilePathType","DataManURL","url","auth","indexOf","headers","urlOpts","dataManUrlGetBuffer","_","extend","method","encoding","jar","res","body","dataManUrlGetDataUri","dataManUrlCreateReadStream","dataManUrlSize","dataManUrlType","PassThrough","stream","pt","dataManReadStreamGetBuffer","dataManReadStreamGetDataUri","dataManReadStreamCreateReadStream","dataManReadStreamSize","dataManReadStreamType"],"mappings":"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","file":"/packages/steedos_cfs-data-man.js","sourcesContent":["// fix warning: xxx not installed\r\nrequire(\"mime/package.json\");\r\nrequire(\"temp/package.json\");\r\n\r\nimport { checkNpmVersions } from 'meteor/tmeasday:check-npm-versions';\r\ncheckNpmVersions({\r\n\tmime: \"^2.0.2\",\r\n\t'buffer-stream-reader': \"0.1.1\",\r\n\t//request: \"2.44.0\",\r\n\t// We use a specific commit from a fork of \"request\" package for now; we need fix for\r\n\t// https://github.com/mikeal/request/issues/887 (https://github.com/CollectionFS/Meteor-CollectionFS/issues/347)\r\n\trequest: \"^2.81.0\",\r\n\ttemp: \"0.7.0\" // for tests only\r\n}, 'steedos:cfs-data-man');","/* global DataMan:true, Buffer */\r\n\r\nvar fs = require(\"fs\");\r\nvar Readable = require('stream').Readable;\r\n\r\n/**\r\n * @method DataMan\r\n * @public\r\n * @constructor\r\n * @param {Buffer|ArrayBuffer|Uint8Array|String} data The data that you want to manipulate.\r\n * @param {String} [type] The data content (MIME) type, if known. Required if the first argument is a Buffer, ArrayBuffer, Uint8Array, or URL\r\n * @param {Object} [options] Currently used only to pass options for the GET request when `data` is a URL.\r\n */\r\nDataMan = function DataMan(data, type, options) {\r\n  var self = this, buffer;\r\n\r\n  if (!data) {\r\n    throw new Error(\"DataMan constructor requires a data argument\");\r\n  }\r\n\r\n  // The end result of all this is that we will have this.source set to a correct\r\n  // data type handler. We are simply detecting what the data arg is.\r\n  //\r\n  // Unless we already have in-memory data, we don't load anything into memory\r\n  // and instead rely on obtaining a read stream when the time comes.\r\n  if (typeof Buffer !== \"undefined\" && data instanceof Buffer) {\r\n    if (!type) {\r\n      throw new Error(\"DataMan constructor requires a type argument when passed a Buffer\");\r\n    }\r\n    self.source = new DataMan.Buffer(data, type);\r\n  } else if (typeof ArrayBuffer !== \"undefined\" && data instanceof ArrayBuffer) {\r\n    if (typeof Buffer === \"undefined\") {\r\n      throw new Error(\"Buffer support required to handle an ArrayBuffer\");\r\n    }\r\n    if (!type) {\r\n      throw new Error(\"DataMan constructor requires a type argument when passed an ArrayBuffer\");\r\n    }\r\n    buffer = new Buffer(new Uint8Array(data));\r\n    self.source = new DataMan.Buffer(buffer, type);\r\n  } else if (EJSON.isBinary(data)) {\r\n    if (typeof Buffer === \"undefined\") {\r\n      throw new Error(\"Buffer support required to handle an ArrayBuffer\");\r\n    }\r\n    if (!type) {\r\n      throw new Error(\"DataMan constructor requires a type argument when passed a Uint8Array\");\r\n    }\r\n    buffer = new Buffer(data);\r\n    self.source = new DataMan.Buffer(buffer, type);\r\n  } else if (typeof Readable !== \"undefined\" && data instanceof Readable) {\r\n    if (!type) {\r\n      throw new Error(\"DataMan constructor requires a type argument when passed a stream.Readable\");\r\n    }\r\n    self.source = new DataMan.ReadStream(data, type);\r\n  } else if (typeof data === \"string\") {\r\n    if (data.slice(0, 5) === \"data:\") {\r\n      self.source = new DataMan.DataURI(data);\r\n    } else if (data.slice(0, 5) === \"http:\" || data.slice(0, 6) === \"https:\") {\r\n      if (!type) {\r\n        throw new Error(\"DataMan constructor requires a type argument when passed a URL\");\r\n      }\r\n      self.source = new DataMan.URL(data, type, options);\r\n    } else {\r\n      // assume it's a filepath\r\n      self.source = new DataMan.FilePath(data, type);\r\n    }\r\n  } else {\r\n    throw new Error(\"DataMan constructor received data that it doesn't support\");\r\n  }\r\n};\r\n\r\n/**\r\n * @method DataMan.prototype.getBuffer\r\n * @public\r\n * @param {function} [callback] callback(err, buffer)\r\n * @returns {Buffer|undefined}\r\n *\r\n * Returns a Buffer representing this data, or passes the Buffer to a callback.\r\n */\r\nDataMan.prototype.getBuffer = function dataManGetBuffer(callback) {\r\n  var self = this;\r\n  return callback ? self.source.getBuffer(callback) : Meteor.wrapAsync(bind(self.source.getBuffer, self.source))();\r\n};\r\n\r\nfunction _saveToFile(readStream, filePath, callback) {\r\n  var writeStream = fs.createWriteStream(filePath);\r\n  writeStream.on('close', Meteor.bindEnvironment(function () {\r\n    callback();\r\n  }, function (error) { callback(error); }));\r\n  writeStream.on('error', Meteor.bindEnvironment(function (error) {\r\n    callback(error);\r\n  }, function (error) { callback(error); }));\r\n  readStream.pipe(writeStream);\r\n}\r\n\r\n/**\r\n * @method DataMan.prototype.saveToFile\r\n * @public\r\n * @param {String} filePath\r\n * @param {Function} callback\r\n * @returns {undefined}\r\n *\r\n * Saves this data to a filepath on the local filesystem.\r\n */\r\nDataMan.prototype.saveToFile = function dataManSaveToFile(filePath, callback) {\r\n  var readStream = this.createReadStream();\r\n  return callback ? _saveToFile(readStream, filePath, callback) : Meteor.wrapAsync(_saveToFile)(readStream, filePath);\r\n};\r\n\r\n/**\r\n * @method DataMan.prototype.getDataUri\r\n * @public\r\n * @param {function} [callback] callback(err, dataUri)\r\n *\r\n * If no callback, returns the data URI.\r\n */\r\nDataMan.prototype.getDataUri = function dataManGetDataUri(callback) {\r\n  var self = this;\r\n  return callback ? self.source.getDataUri(callback) : Meteor.wrapAsync(bind(self.source.getDataUri, self.source))();\r\n};\r\n\r\n/**\r\n * @method DataMan.prototype.createReadStream\r\n * @public\r\n *\r\n * Returns a read stream for the data.\r\n */\r\nDataMan.prototype.createReadStream = function dataManCreateReadStream() {\r\n  return this.source.createReadStream();\r\n};\r\n\r\n/**\r\n * @method DataMan.prototype.size\r\n * @public\r\n * @param {function} [callback] callback(err, size)\r\n *\r\n * If no callback, returns the size in bytes of the data.\r\n */\r\nDataMan.prototype.size = function dataManSize(callback) {\r\n  var self = this;\r\n  return callback ? self.source.size(callback) : Meteor.wrapAsync(bind(self.source.size, self.source))();\r\n};\r\n\r\n/**\r\n * @method DataMan.prototype.type\r\n * @public\r\n *\r\n * Returns the type of the data.\r\n */\r\nDataMan.prototype.type = function dataManType() {\r\n  return this.source.type();\r\n};\r\n\r\n/*\r\n * \"bind\" shim; from underscorejs, but we avoid a dependency\r\n */\r\nvar slice = Array.prototype.slice;\r\nvar nativeBind = Function.prototype.bind;\r\nvar ctor = function(){};\r\nfunction isFunction(obj) {\r\n  return Object.prototype.toString.call(obj) == '[object Function]';\r\n}\r\nfunction bind(func, context) {\r\n  var args, bound;\r\n  if (nativeBind && func.bind === nativeBind) return nativeBind.apply(func, slice.call(arguments, 1));\r\n  if (!isFunction(func)) throw new TypeError;\r\n  args = slice.call(arguments, 2);\r\n  return bound = function() {\r\n    if (!(this instanceof bound)) return func.apply(context, args.concat(slice.call(arguments)));\r\n    ctor.prototype = func.prototype;\r\n    var self = new ctor;\r\n    ctor.prototype = null;\r\n    var result = func.apply(self, args.concat(slice.call(arguments)));\r\n    if (Object(result) === result) return result;\r\n    return self;\r\n  };\r\n}\r\n","var bufferStreamReader = require('buffer-stream-reader');\r\n\r\n/**\r\n * @method DataMan.Buffer\r\n * @public\r\n * @constructor\r\n * @param {Buffer} buffer\r\n * @param {String} type The data content (MIME) type.\r\n */\r\nDataMan.Buffer = function DataManBuffer(buffer, type) {\r\n  var self = this;\r\n  self.buffer = buffer;\r\n  self._type = type;\r\n};\r\n\r\n/**\r\n * @method DataMan.Buffer.prototype.getBuffer\r\n * @private\r\n * @param {function} callback callback(err, buffer)\r\n * @returns {Buffer|undefined}\r\n *\r\n * Passes a Buffer representing the data to a callback.\r\n */\r\nDataMan.Buffer.prototype.getBuffer = function dataManBufferGetBuffer(callback) {\r\n  callback(null, this.buffer);\r\n};\r\n\r\n/**\r\n * @method DataMan.Buffer.prototype.getDataUri\r\n * @private\r\n * @param {function} callback callback(err, dataUri)\r\n *\r\n * Passes a data URI representing the data in the buffer to a callback.\r\n */\r\nDataMan.Buffer.prototype.getDataUri = function dataManBufferGetDataUri(callback) {\r\n  var self = this;\r\n  if (!self._type) {\r\n    callback(new Error(\"DataMan.getDataUri couldn't get a contentType\"));\r\n  } else {\r\n    var dataUri = \"data:\" + self._type + \";base64,\" + self.buffer.toString(\"base64\");\r\n    callback(null, dataUri);\r\n  }\r\n};\r\n\r\n/**\r\n * @method DataMan.Buffer.prototype.createReadStream\r\n * @private\r\n *\r\n * Returns a read stream for the data.\r\n */\r\nDataMan.Buffer.prototype.createReadStream = function dataManBufferCreateReadStream() {\r\n  return new bufferStreamReader(this.buffer);\r\n};\r\n\r\n/**\r\n * @method DataMan.Buffer.prototype.size\r\n * @param {function} callback callback(err, size)\r\n * @private\r\n *\r\n * Passes the size in bytes of the data in the buffer to a callback.\r\n */\r\nDataMan.Buffer.prototype.size = function dataManBufferSize(callback) {\r\n  var self = this;\r\n\r\n  if (typeof self._size === \"number\") {\r\n    callback(null, self._size);\r\n    return;\r\n  }\r\n\r\n  self._size = self.buffer.length;\r\n  callback(null, self._size);\r\n};\r\n\r\n/**\r\n * @method DataMan.Buffer.prototype.type\r\n * @private\r\n *\r\n * Returns the type of the data.\r\n */\r\nDataMan.Buffer.prototype.type = function dataManBufferType() {\r\n  return this._type;\r\n};\r\n","/**\r\n * @method DataMan.DataURI\r\n * @public\r\n * @constructor\r\n * @param {String} dataUri\r\n */\r\nDataMan.DataURI = function DataManDataURI(dataUri) {\r\n  var self = this;\r\n  var pieces = dataUri.match(/^data:(.*);base64,(.*)$/);\r\n  var buffer = new Buffer(pieces[2], 'base64');\r\n  return new DataMan.Buffer(buffer, pieces[1]);\r\n};\r\n\r\nDataMan.DataURI.prototype = DataMan.Buffer.prototype;\r\n","var mime = require('mime');\r\nvar fs = require(\"fs\");\r\n\r\n/**\r\n * @method DataMan.FilePath\r\n * @public\r\n * @constructor\r\n * @param {String} filepath\r\n * @param {String} [type] The data content (MIME) type. Will lookup from file if not passed.\r\n */\r\nDataMan.FilePath = function DataManFilePath(filepath, type) {\r\n  var self = this;\r\n  self.filepath = filepath;\r\n  self._type = type || mime.lookup(filepath);\r\n};\r\n\r\n/**\r\n * @method DataMan.FilePath.prototype.getBuffer\r\n * @private\r\n * @param {function} callback callback(err, buffer)\r\n * @returns {Buffer|undefined}\r\n *\r\n * Passes a Buffer representing the data to a callback.\r\n */\r\nDataMan.FilePath.prototype.getBuffer = function dataManFilePathGetBuffer(callback) {\r\n  var self = this;\r\n\r\n  // Call node readFile\r\n  fs.readFile(self.filepath, Meteor.bindEnvironment(function(err, buffer) {\r\n    callback(err, buffer);\r\n  }, function(err) {\r\n    callback(err);\r\n  }));\r\n};\r\n\r\n/**\r\n * @method DataMan.FilePath.prototype.getDataUri\r\n * @private\r\n * @param {function} callback callback(err, dataUri)\r\n *\r\n * Passes a data URI representing the data to a callback.\r\n */\r\nDataMan.FilePath.prototype.getDataUri = function dataManFilePathGetDataUri(callback) {\r\n  var self = this;\r\n\r\n  self.getBuffer(function (error, buffer) {\r\n    if (error) {\r\n      callback(error);\r\n    } else {\r\n      if (!self._type) {\r\n        callback(new Error(\"DataMan.getDataUri couldn't get a contentType\"));\r\n      } else {\r\n        var dataUri = \"data:\" + self._type + \";base64,\" + buffer.toString(\"base64\");\r\n        buffer = null;\r\n        callback(null, dataUri);\r\n      }\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * @method DataMan.FilePath.prototype.createReadStream\r\n * @private\r\n *\r\n * Returns a read stream for the data.\r\n */\r\nDataMan.FilePath.prototype.createReadStream = function dataManFilePathCreateReadStream() {\r\n  // Stream from filesystem\r\n  return fs.createReadStream(this.filepath);\r\n};\r\n\r\n/**\r\n * @method DataMan.FilePath.prototype.size\r\n * @param {function} callback callback(err, size)\r\n * @private\r\n *\r\n * Passes the size in bytes of the data to a callback.\r\n */\r\nDataMan.FilePath.prototype.size = function dataManFilePathSize(callback) {\r\n  var self = this;\r\n\r\n  if (typeof self._size === \"number\") {\r\n    callback(null, self._size);\r\n    return;\r\n  }\r\n\r\n  // We can get the size without buffering\r\n  fs.stat(self.filepath, Meteor.bindEnvironment(function (error, stats) {\r\n    if (stats && typeof stats.size === \"number\") {\r\n      self._size = stats.size;\r\n      callback(null, self._size);\r\n    } else {\r\n      callback(error);\r\n    }\r\n  }, function (error) {\r\n    callback(error);\r\n  }));\r\n};\r\n\r\n/**\r\n * @method DataMan.FilePath.prototype.type\r\n * @private\r\n *\r\n * Returns the type of the data.\r\n */\r\nDataMan.FilePath.prototype.type = function dataManFilePathType() {\r\n  return this._type;\r\n};\r\n","var request = require(\"request\");\r\n\r\n/**\r\n * @method DataMan.URL\r\n * @public\r\n * @constructor\r\n * @param {String} url\r\n * @param {String} type The data content (MIME) type.\r\n */\r\nDataMan.URL = function DataManURL(url, type, options) {\r\n  var self = this;\r\n  options = options || {};\r\n\r\n  self.url = url;\r\n  self._type = type;\r\n\r\n  // This is some code borrowed from the http package. Hopefully\r\n  // we can eventually use HTTP pkg directly instead of 'request'\r\n  // once it supports streams and buffers and such. (`request` takes\r\n  // and `auth` option, too, but not of the same form as `HTTP`.)\r\n  if (options.auth) {\r\n    if (options.auth.indexOf(':') < 0)\r\n      throw new Error('auth option should be of the form \"username:password\"');\r\n    options.headers = options.headers || {};\r\n    options.headers['Authorization'] = \"Basic \"+\r\n      (new Buffer(options.auth, \"ascii\")).toString(\"base64\");\r\n    delete options.auth;\r\n  }\r\n\r\n  self.urlOpts = options;\r\n};\r\n\r\n/**\r\n * @method DataMan.URL.prototype.getBuffer\r\n * @private\r\n * @param {function} callback callback(err, buffer)\r\n * @returns {Buffer|undefined}\r\n *\r\n * Passes a Buffer representing the data at the URL to a callback.\r\n */\r\nDataMan.URL.prototype.getBuffer = function dataManUrlGetBuffer(callback) {\r\n  var self = this;\r\n\r\n  request(_.extend({\r\n    url: self.url,\r\n    method: \"GET\",\r\n    encoding: null,\r\n    jar: false\r\n  }, self.urlOpts), Meteor.bindEnvironment(function(err, res, body) {\r\n    if (err) {\r\n      callback(err);\r\n    } else {\r\n      self._type = res.headers['content-type'];\r\n      callback(null, body);\r\n    }\r\n  }, function(err) {\r\n    callback(err);\r\n  }));\r\n};\r\n\r\n/**\r\n * @method DataMan.URL.prototype.getDataUri\r\n * @private\r\n * @param {function} callback callback(err, dataUri)\r\n *\r\n * Passes a data URI representing the data at the URL to a callback.\r\n */\r\nDataMan.URL.prototype.getDataUri = function dataManUrlGetDataUri(callback) {\r\n  var self = this;\r\n\r\n  self.getBuffer(function (error, buffer) {\r\n    if (error) {\r\n      callback(error);\r\n    } else {\r\n      if (!self._type) {\r\n        callback(new Error(\"DataMan.getDataUri couldn't get a contentType\"));\r\n      } else {\r\n        var dataUri = \"data:\" + self._type + \";base64,\" + buffer.toString(\"base64\");\r\n        callback(null, dataUri);\r\n      }\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * @method DataMan.URL.prototype.createReadStream\r\n * @private\r\n *\r\n * Returns a read stream for the data.\r\n */\r\nDataMan.URL.prototype.createReadStream = function dataManUrlCreateReadStream() {\r\n  var self = this;\r\n  // Stream from URL\r\n  return request(_.extend({\r\n    url: self.url,\r\n    method: \"GET\"\r\n  }, self.urlOpts));\r\n};\r\n\r\n/**\r\n * @method DataMan.URL.prototype.size\r\n * @param {function} callback callback(err, size)\r\n * @private\r\n *\r\n * Returns the size in bytes of the data at the URL.\r\n */\r\nDataMan.URL.prototype.size = function dataManUrlSize(callback) {\r\n  var self = this;\r\n\r\n  if (typeof self._size === \"number\") {\r\n    callback(null, self._size);\r\n    return;\r\n  }\r\n\r\n  self.getBuffer(function (error, buffer) {\r\n    if (error) {\r\n      callback(error);\r\n    } else {\r\n      self._size = buffer.length;\r\n      callback(null, self._size);\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * @method DataMan.URL.prototype.type\r\n * @private\r\n *\r\n * Returns the type of the data.\r\n */\r\nDataMan.URL.prototype.type = function dataManUrlType() {\r\n  return this._type;\r\n};\r\n","/* global DataMan */\r\n\r\nvar PassThrough = require('stream').PassThrough;\r\n\r\n/**\r\n * @method DataMan.ReadStream\r\n * @public\r\n * @constructor\r\n * @param {ReadStream} stream\r\n * @param {String} type The data content (MIME) type.\r\n */\r\nDataMan.ReadStream = function DataManBuffer(stream, type) {\r\n  var self = this;\r\n\r\n  // Create a bufferable / paused new stream...\r\n  var pt = new PassThrough();\r\n\r\n  // Pipe provided read stream into pass-through stream\r\n  stream.pipe(pt);\r\n\r\n  // Set pass-through stream reference\r\n  self.stream = pt;\r\n\r\n  // Set type as provided\r\n  self._type = type;\r\n};\r\n\r\n/**\r\n * @method DataMan.ReadStream.prototype.getBuffer\r\n * @private\r\n * @param {function} callback callback(err, buffer)\r\n * @returns {undefined}\r\n *\r\n * Passes a Buffer representing the data to a callback.\r\n */\r\nDataMan.ReadStream.prototype.getBuffer = function dataManReadStreamGetBuffer(/*callback*/) {\r\n  // TODO implement as passthrough stream?\r\n};\r\n\r\n/**\r\n * @method DataMan.ReadStream.prototype.getDataUri\r\n * @private\r\n * @param {function} callback callback(err, dataUri)\r\n *\r\n * Passes a data URI representing the data in the stream to a callback.\r\n */\r\nDataMan.ReadStream.prototype.getDataUri = function dataManReadStreamGetDataUri(/*callback*/) {\r\n  // TODO implement as passthrough stream?\r\n};\r\n\r\n/**\r\n * @method DataMan.ReadStream.prototype.createReadStream\r\n * @private\r\n *\r\n * Returns a read stream for the data.\r\n */\r\nDataMan.ReadStream.prototype.createReadStream = function dataManReadStreamCreateReadStream() {\r\n  return this.stream;\r\n};\r\n\r\n/**\r\n * @method DataMan.ReadStream.prototype.size\r\n * @param {function} callback callback(err, size)\r\n * @private\r\n *\r\n * Passes the size in bytes of the data in the stream to a callback.\r\n */\r\nDataMan.ReadStream.prototype.size = function dataManReadStreamSize(callback) {\r\n  callback(0); // will determine from stream later\r\n};\r\n\r\n/**\r\n * @method DataMan.ReadStream.prototype.type\r\n * @private\r\n *\r\n * Returns the type of the data.\r\n */\r\nDataMan.ReadStream.prototype.type = function dataManReadStreamType() {\r\n  return this._type;\r\n};\r\n"]}