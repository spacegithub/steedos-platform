{"version":3,"sources":["meteor://ðŸ’»app/packages/steedos:api-authenticate-user/checkNpm.js","meteor://ðŸ’»app/packages/steedos_api-authenticate-user/auth_user.coffee","meteor://ðŸ’»app/auth_user.coffee","meteor://ðŸ’»app/packages/steedos_api-authenticate-user/routes_middleware_config.coffee"],"names":["checkNpmVersions","module","link","v","Fiber","require","JsonRoutes","Middleware","authenticateMeteorUser","req","res","next","ref","userId","Steedos","getUserIdFromAccessToken","query","access_token","getUserIdFromAuthToken","run","use"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAIA,gBAAJ;AAAqBC,MAAM,CAACC,IAAP,CAAY,oCAAZ,EAAiD;AAACF,kBAAgB,CAACG,CAAD,EAAG;AAACH,oBAAgB,GAACG,CAAjB;AAAmB;;AAAxC,CAAjD,EAA2F,CAA3F;AACrBH,gBAAgB,CAAC,EAAD,EACb,+BADa,CAAhB,C;;;;;;;;;;;;ACDA,IAAAI,KAAA;AAAAA,QAAQC,QAAQ,QAAR,CAAR;;AAEAC,WAAWC,UAAX,CAAsBC,sBAAtB,GAA+C,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX;ACG7C,SDDDP,MAAM;AACL,QAAAQ,GAAA,EAAAC,MAAA;;AAAA,QAAG,CAACJ,IAAII,MAAR;AACCA,eAASC,QAAQC,wBAAR,EAAAH,MAAAH,IAAAO,KAAA,YAAAJ,IAA4CK,YAA5C,GAA4C,MAA5C,CAAT;;AAEA,UAAG,CAAIJ,MAAP;AACCA,iBAASC,QAAQI,sBAAR,CAA+BT,GAA/B,EAAoCC,GAApC,CAAT;ACEG;;ADAJ,UAAGG,MAAH;AACCJ,YAAII,MAAJ,GAAaA,MAAb;AAPF;ACUG;;AACD,WDFFF,MCEE;ADZH,KAWEQ,GAXF,ECCC;ADH6C,CAA/C,C;;;;;;;;;;;;AEFAb,WAAWC,UAAX,CAAsBa,GAAtB,CAA0B,MAA1B,EAAkCd,WAAWC,UAAX,CAAsBC,sBAAxD;AAEAF,WAAWC,UAAX,CAAsBa,GAAtB,CAA0B,0BAA1B,EAAsDd,WAAWC,UAAX,CAAsBC,sBAA5E;AAEAF,WAAWC,UAAX,CAAsBa,GAAtB,CAA0B,cAA1B,EAA0Cd,WAAWC,UAAX,CAAsBC,sBAAhE;AACAF,WAAWC,UAAX,CAAsBa,GAAtB,CAA0B,iBAA1B,EAA6Cd,WAAWC,UAAX,CAAsBC,sBAAnE,E","file":"/packages/steedos_api-authenticate-user.js","sourcesContent":["import { checkNpmVersions } from 'meteor/tmeasday:check-npm-versions';\ncheckNpmVersions({\n}, 'steedos:api-authenticate-user');","Fiber = require('fibers');\n\nJsonRoutes.Middleware.authenticateMeteorUser = (req, res, next)->\n\n\tFiber(()->\n\t\tif !req.userId\n\t\t\tuserId = Steedos.getUserIdFromAccessToken(req.query?.access_token);\n\n\t\t\tif not userId\n\t\t\t\tuserId = Steedos.getUserIdFromAuthToken(req, res);\n\n\t\t\tif userId\n\t\t\t\treq.userId = userId;\n\n\t\tnext();\n\t).run()","var Fiber;\n\nFiber = require('fibers');\n\nJsonRoutes.Middleware.authenticateMeteorUser = function(req, res, next) {\n  return Fiber(function() {\n    var ref, userId;\n    if (!req.userId) {\n      userId = Steedos.getUserIdFromAccessToken((ref = req.query) != null ? ref.access_token : void 0);\n      if (!userId) {\n        userId = Steedos.getUserIdFromAuthToken(req, res);\n      }\n      if (userId) {\n        req.userId = userId;\n      }\n    }\n    return next();\n  }).run();\n};\n","JsonRoutes.Middleware.use('/api', JsonRoutes.Middleware.authenticateMeteorUser);\n\nJsonRoutes.Middleware.use('/steedos/api/space_users', JsonRoutes.Middleware.authenticateMeteorUser);\n\nJsonRoutes.Middleware.use('/tableau/api', JsonRoutes.Middleware.authenticateMeteorUser);\nJsonRoutes.Middleware.use('/tableau/search', JsonRoutes.Middleware.authenticateMeteorUser);\n\n"]}