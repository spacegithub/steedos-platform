{"version":3,"sources":["meteor://💻app/packages/steedos_objects-billing/models/billings.coffee","meteor://💻app/models/billings.coffee","meteor://💻app/packages/steedos_objects-billing/models/billing_pay_records.coffee","meteor://💻app/models/billing_pay_records.coffee","meteor://💻app/packages/steedos_objects-billing/models/modules.coffee","meteor://💻app/packages/steedos_objects-billing/models/modules_changelogs.coffee","meteor://💻app/packages/steedos_objects-billing/models/users_changelogs.coffee","meteor://💻app/models/users_changelogs.coffee","meteor://💻app/packages/steedos_objects-billing/models/steedos_statistics.coffee"],"names":["db","billings","Meteor","Collection","helpers","transaction_i18n","d","t","transaction","TAPi18n","__","isServer","_ensureIndex","background","billing_pay_records","order_created","moment","created","format","order_paid","paid","order_total_fee","total_fee","toString","modules","modules_changelogs","users_changelogs","_simpleSchema","SimpleSchema","change_date","type","Date","operator","String","space","operation","user","user_count","Number","created_by","before","insert","userId","doc","steedos_statistics"],"mappings":"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","file":"/packages/steedos_objects-billing.js","sourcesContent":["db.billings = new Meteor.Collection('billings')\n\n\ndb.billings.helpers\n\ttransaction_i18n: ()->\n\t\tt = this.transaction\n\t\td = \"\"\n\t\tif t is \"Starting balance\"\n\t\t\td = TAPi18n.__('billing_tranDetail.starting')\n\t\telse if t is \"Payment\"\n\t\t\td = TAPi18n.__('billing_tranDetail.payment')\n\t\telse if t is \"Service adjustment\"\n\t\t\td = TAPi18n.__('billing_tranDetail.adjustment')\n\t\telse if t is \"workflow\"\n\t\t\td = TAPi18n.__('billing_tranDetail.workflow')\n\t\telse if t is \"workflow.professional\"\n\t\t\td = TAPi18n.__('billing_tranDetail.workflow')\n\t\telse if t is \"chat.professional\"\n\t\t\td = TAPi18n.__('billing_tranDetail.chat')\n\t\telse\n\t\t\td = t\n\n\t\treturn d\n\nif Meteor.isServer\n\tdb.billings._ensureIndex({\n\t\t\"space\": 1\n\t},{background: true})","db.billings = new Meteor.Collection('billings');\n\ndb.billings.helpers({\n  transaction_i18n: function() {\n    var d, t;\n    t = this.transaction;\n    d = \"\";\n    if (t === \"Starting balance\") {\n      d = TAPi18n.__('billing_tranDetail.starting');\n    } else if (t === \"Payment\") {\n      d = TAPi18n.__('billing_tranDetail.payment');\n    } else if (t === \"Service adjustment\") {\n      d = TAPi18n.__('billing_tranDetail.adjustment');\n    } else if (t === \"workflow\") {\n      d = TAPi18n.__('billing_tranDetail.workflow');\n    } else if (t === \"workflow.professional\") {\n      d = TAPi18n.__('billing_tranDetail.workflow');\n    } else if (t === \"chat.professional\") {\n      d = TAPi18n.__('billing_tranDetail.chat');\n    } else {\n      d = t;\n    }\n    return d;\n  }\n});\n\nif (Meteor.isServer) {\n  db.billings._ensureIndex({\n    \"space\": 1\n  }, {\n    background: true\n  });\n}\n","db.billing_pay_records = new Meteor.Collection('billing_pay_records')\n\ndb.billing_pay_records.helpers\n\torder_created: ()->\n\t\treturn moment(this.created).format('YYYY-MM-DD HH:mm:ss')\n\n\torder_paid: ()->\n\t\treturn if this.paid then TAPi18n.__(\"billing.has_paid\") else TAPi18n.__(\"billing.not_paid\")\n\n\torder_total_fee: ()->\n\t\treturn (this.total_fee/100).toString()\n\n# Creator.Objects.billing_pay_records = \n# \tname: \"billing_pay_records\"\n# \tlabel: \"订单\"\n# \ticon: \"apps\"\n# \tfields:\n# \t\tinfo:\n# \t\t\tlabel:\"详单详情\"\n# \t\t\ttype: \"object\"\n# \t\t\tblackbox: true\n# \t\t\tomit: true\n# \t\t\thidden: true\n\t\t\n# \t\ttotal_fee:\n# \t\t\tlabel:\"金额￥\"\n# \t\t\ttype: \"number\"\n# \t\t\tdefaultValue: 100\n# \t\t\tomit: true\n\t\t\n# \t\tpaid:\n# \t\t\tlabel:\"已付款\"\n# \t\t\ttype: \"boolean\"\n# \t\t\tomit: true\n# \t\t\tdefaultValue: false\n\t\t\n# \t\tmodules:\n# \t\t\tlabel:\"模块\"\n# \t\t\ttype: \"[text]\"\n# \t\t\tblackbox: true\n# \t\t\tomit: true\n\t\t\n# \t\tend_date:\n# \t\t\tlabel:\"租用日期至\"\n# \t\t\ttype: \"date\"\n# \t\t\tomit: true\n\t\t\n# \t\tuser_count:\n# \t\t\tlabel:\"名额\"\n# \t\t\ttype: \"number\"\n# \t\t\tomit: true\n\n# \tlist_views:\n# \t\tall:\n# \t\t\tlabel: \"所有\"\n# \t\t\tfilter_scope: \"space\"\n# \t\t\tcolumns: [\"modules\", \"user_count\", \"end_date\", \"total_fee\", \"paid\", \"created\"]\n\t\n# \tpermission_set:\n# \t\tuser:\n# \t\t\tallowCreate: false\n# \t\t\tallowDelete: false\n# \t\t\tallowEdit: false\n# \t\t\tallowRead: false\n# \t\t\tmodifyAllRecords: false\n# \t\t\tviewAllRecords: false \n# \t\tadmin:\n# \t\t\tallowCreate: false\n# \t\t\tallowDelete: false\n# \t\t\tallowEdit: false\n# \t\t\tallowRead: true\n# \t\t\tmodifyAllRecords: false\n# \t\t\tviewAllRecords: true","db.billing_pay_records = new Meteor.Collection('billing_pay_records');\n\ndb.billing_pay_records.helpers({\n  order_created: function() {\n    return moment(this.created).format('YYYY-MM-DD HH:mm:ss');\n  },\n  order_paid: function() {\n    if (this.paid) {\n      return TAPi18n.__(\"billing.has_paid\");\n    } else {\n      return TAPi18n.__(\"billing.not_paid\");\n    }\n  },\n  order_total_fee: function() {\n    return (this.total_fee / 100).toString();\n  }\n});\n","db.modules = new Meteor.Collection('modules')","db.modules_changelogs = new Meteor.Collection('modules_changelogs')","db.users_changelogs = new Meteor.Collection('users_changelogs')\n\ndb.users_changelogs._simpleSchema = new SimpleSchema\n  # 日期，记录事件发生的时间，格式：YYYYMMDD\n  change_date:\n    type: Date\n  # 操作者\n  operator:\n    type: String\n  # 工作区\n  space:\n    type: String\n  # add（增加）delete（删除）enable（启用）disable（停用）\n  operation:\n    type: String\n  # 对象，user_id\n  user:\n    type: String\n  # 工作区中启用的用户数\n  user_count:\n    type: Number\n  # 创建时间\n  created:\n    type: Date\n  # 创建人\n  created_by:\n    type: String\n\n\nif Meteor.isServer\n  db.users_changelogs.before.insert (userId, doc) ->\n    doc.change_date = moment().format('YYYYMMDD');\n    doc.created = new Date();\n    doc.created_by = userId;\n\n","db.users_changelogs = new Meteor.Collection('users_changelogs');\n\ndb.users_changelogs._simpleSchema = new SimpleSchema({\n  change_date: {\n    type: Date\n  },\n  operator: {\n    type: String\n  },\n  space: {\n    type: String\n  },\n  operation: {\n    type: String\n  },\n  user: {\n    type: String\n  },\n  user_count: {\n    type: Number\n  },\n  created: {\n    type: Date\n  },\n  created_by: {\n    type: String\n  }\n});\n\nif (Meteor.isServer) {\n  db.users_changelogs.before.insert(function(userId, doc) {\n    doc.change_date = moment().format('YYYYMMDD');\n    doc.created = new Date();\n    return doc.created_by = userId;\n  });\n}\n","db.steedos_statistics = new Meteor.Collection('steedos_statistics')\n"]}